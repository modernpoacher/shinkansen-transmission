"use strict";require("core-js/modules/es.array.is-array.js");require("core-js/modules/es.symbol.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.symbol.iterator.js");require("core-js/modules/es.array.iterator.js");require("core-js/modules/es.string.iterator.js");require("core-js/modules/web.dom-collections.iterator.js");require("core-js/modules/es.function.name.js");require("core-js/modules/es.array.from.js");require("core-js/modules/es.object.define-property.js");require("core-js/modules/es.date.to-string.js");require("core-js/modules/es.regexp.to-string.js");Object.defineProperty(exports,"__esModule",{value:true});exports.toNull=toNull;exports.toBoolean=toBoolean;exports.toString=toString;exports.toNumber=toNumber;exports.transformValueFor=transformValueFor;exports.getArrayFor=getArrayFor;exports.transformArrayFor=transformArrayFor;exports.transformObjectFor=transformObjectFor;exports.transformItemsArrayFor=transformItemsArrayFor;exports.transformItemsObjectFor=transformItemsObjectFor;exports.transformObjectSchemaNull=transformObjectSchemaNull;exports.transformObjectSchemaBoolean=transformObjectSchemaBoolean;exports.transformObjectSchemaObject=transformObjectSchemaObject;exports.transformObjectSchemaArray=transformObjectSchemaArray;exports.transformObjectSchemaNumber=transformObjectSchemaNumber;exports.transformObjectSchemaString=transformObjectSchemaString;exports.transformObjectSchema=transformObjectSchema;exports.transformArraySchemaNull=transformArraySchemaNull;exports.transformArraySchemaBoolean=transformArraySchemaBoolean;exports.transformArraySchemaObject=transformArraySchemaObject;exports.transformArraySchemaArray=transformArraySchemaArray;exports.transformArraySchemaNumber=transformArraySchemaNumber;exports.transformArraySchemaString=transformArraySchemaString;exports.transformArraySchema=transformArraySchema;exports.transformNull=transformNull;exports.transformBoolean=transformBoolean;exports.transformObject=transformObject;exports.transformArray=transformArray;exports.transformNumber=transformNumber;exports.transformString=transformString;exports["default"]=transform;exports.transformValue=void 0;require("core-js/modules/es.number.constructor.js");require("core-js/modules/es.reflect.has.js");require("core-js/modules/es.reflect.get.js");require("core-js/modules/es.array.reduce.js");require("core-js/modules/es.object.entries.js");require("core-js/modules/es.array.filter.js");require("core-js/modules/es.object.keys.js");require("core-js/modules/es.string.starts-with.js");require("core-js/modules/es.string.ends-with.js");require("core-js/modules/es.array.slice.js");require("core-js/modules/es.array.includes.js");require("core-js/modules/es.string.includes.js");require("core-js/modules/es.array.index-of.js");require("core-js/modules/es.array.map.js");var _debug=_interopRequireDefault(require("debug"));var _common=require("../common");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}var log=(0,_debug["default"])('shinkansen-transmission:from-hash-to-document');log('`shinkansen-transmission` is awake');function toNull(v){if(v===null||v==='null')return null;throw new Error('Invalid `null`');}function toBoolean(v){if(typeof v==='boolean')return v;if(v==='true')return true;if(v==='false')return false;throw new Error('Invalid `boolean`');}function toString(v){if(typeof v==='string')return v;if(typeof v==='number')return String(v);return JSON.stringify(v);}function toNumber(v){if(typeof v==='number')return v;if(v){var n=Number(v);if(!isNaN(n))return n;}throw new Error('Invalid `number`');}var transformValue=function transformValue(schema){return(0,_common.isObject)(schema)?(0,_common.isConstValue)(schema)?(0,_common.toConstValue)(schema):(0,_common.isDefaultValue)(schema)?(0,_common.toDefaultValue)(schema):schema:schema;};exports.transformValue=transformValue;function transformValueFor(value,array){try{var i=toNumber(value);if(Reflect.has(array,i)){var v=Reflect.get(array,i);return transformValue(v);}}catch(_ref){var _ref$message=_ref.message;var message=_ref$message===void 0?'No error message defined':_ref$message;log(message);}return value;}function getArrayFor(values){var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var uri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';if(Reflect.has(values,uri)){var v=Reflect.get(values,uri);var i=Number(v);if(!isNaN(i))return array[i];}return[];}function transformArrayFor(values){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$items=_ref2.items,items=_ref2$items===void 0?null:_ref2$items;var parentUri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri);if((0,_common.isArray)(items)){return transformItemsArrayFor(values,items,parentUri,uri);}else{if((0,_common.isObject)(items)){return transformItemsObjectFor(values,items,parentUri,uri);}}return[];}function transformObjectFor(values){var _ref3=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref3$properties=_ref3.properties,properties=_ref3$properties===void 0?null:_ref3$properties;var parentUri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri);if((0,_common.isObject)(properties)){return Object.entries(properties).reduce(function(accumulator,_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],schema=_ref5[1];var schemaUri=(0,_common.getUri)(parentUri,key);accumulator[key]=transform(values,schema,schemaUri,schemaUri);return accumulator;},{});}return{};}function transformItemsArrayFor(values){var items=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var parentUri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri);if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.isArray)(value)){return transform(values,items,uri,uri);}}return Object.keys(values).filter(function(key){return key.startsWith(uri);}).reduce(function(accumulator,key){var v=uri.endsWith('/')?key.slice(uri.length):key.slice(uri.length+1);var i=v?Number(v.includes('/')?v.slice(0,v.indexOf('/')):v):NaN;if(!isNaN(i)){var schemaUri=(0,_common.getUri)(parentUri,i);accumulator[i]=transform(values,items[i],schemaUri,schemaUri);}return accumulator;},[]);}function transformItemsObjectFor(values){var items=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var parentUri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri);if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.isArray)(value)){return transform(values,items,uri,uri);}}return Object.keys(values).filter(function(key){return key.startsWith(uri);}).reduce(function(accumulator,key){var v=uri.endsWith('/')?key.slice(uri.length):key.slice(uri.length+1);var i=v?Number(v.includes('/')?v.slice(0,v.indexOf('/')):v):NaN;if(!isNaN(i)){var schemaUri=(0,_common.getUri)(parentUri,i);accumulator[i]=transform(values,items,schemaUri,schemaUri);}return accumulator;},[]);}var handleError=function handleError(_ref6){var _ref6$message=_ref6.message,message=_ref6$message===void 0?'No error message defined':_ref6$message;return log(message);};function transformObjectSchemaNull(values,schema,_ref7){var parentUri=_ref7.uri,fieldKey=_ref7.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformNull(values,schema,parentUri,uri);}function transformObjectSchemaBoolean(values,schema,_ref8){var parentUri=_ref8.uri,fieldKey=_ref8.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformBoolean(values,schema,parentUri,uri);}function transformObjectSchemaObject(values,schema,_ref9){var parentUri=_ref9.uri,fieldKey=_ref9.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformObject(values,schema,uri,uri);}function transformObjectSchemaArray(values,schema,_ref10){var parentUri=_ref10.uri,fieldKey=_ref10.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformArray(values,schema,uri,uri);}function transformObjectSchemaNumber(values,schema,_ref11){var parentUri=_ref11.uri,fieldKey=_ref11.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformNumber(values,schema,parentUri,uri);}function transformObjectSchemaString(values,schema,_ref12){var parentUri=_ref12.uri,fieldKey=_ref12.key;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,fieldKey);return transformString(values,schema,parentUri,uri);}function transformObjectSchema(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var type=schema.type;switch(type){case'null':return transformObjectSchemaNull(values,schema,params);case'boolean':return transformObjectSchemaBoolean(values,schema,params);case'object':return transformObjectSchemaObject(values,schema,params);case'array':return transformObjectSchemaArray(values,schema,params);case'number':return transformObjectSchemaNumber(values,schema,params);case'string':return transformObjectSchemaString(values,schema,params);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}function transformArraySchemaNull(values,schema,_ref13){var parentUri=_ref13.uri,arrayIndex=_ref13.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformNull(values,schema,parentUri,uri);}function transformArraySchemaBoolean(values,schema,_ref14){var parentUri=_ref14.uri,arrayIndex=_ref14.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformBoolean(values,schema,parentUri,uri);}function transformArraySchemaObject(values,schema,_ref15){var parentUri=_ref15.uri,arrayIndex=_ref15.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformObject(values,schema,uri,uri);}function transformArraySchemaArray(values,schema,_ref16){var parentUri=_ref16.uri,arrayIndex=_ref16.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformArray(values,schema,uri,uri);}function transformArraySchemaNumber(values,schema,_ref17){var parentUri=_ref17.uri,arrayIndex=_ref17.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformNumber(values,schema,parentUri,uri);}function transformArraySchemaString(values,schema,_ref18){var parentUri=_ref18.uri,arrayIndex=_ref18.index;var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri,arrayIndex);return transformString(values,schema,parentUri,uri);}function transformArraySchema(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var schema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var type=schema.type;switch(type){case'null':return transformArraySchemaNull(values,schema,params);case'boolean':return transformArraySchemaBoolean(values,schema,params);case'object':return transformArraySchemaObject(values,schema,params);case'array':return transformArraySchemaArray(values,schema,params);case'number':return transformArraySchemaNumber(values,schema,params);case'string':return transformArraySchemaString(values,schema,params);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}function transformNull(values,schema,parentUri,uri){if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,array);});return transformValueFor(value,array);}else{if((0,_common.hasAnyOf)(schema)){var _array=(0,_common.getAnyOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array);});return transformValueFor(value,_array);}else{if((0,_common.hasOneOf)(schema)){var _array2=(0,_common.getOneOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array2);});return transformValueFor(value,_array2);}}}try{if((0,_common.isArray)(value))return value.map(toNull);return toNull(value);}catch(e){handleError(e);}return value;}}function transformBoolean(values,schema,parentUri,uri){if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,array);});return transformValueFor(value,array);}else{if((0,_common.hasAnyOf)(schema)){var _array3=(0,_common.getAnyOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array3);});return transformValueFor(value,_array3);}else{if((0,_common.hasOneOf)(schema)){var _array4=(0,_common.getOneOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array4);});return transformValueFor(value,_array4);}}}try{if((0,_common.isArray)(value))return value.map(toBoolean);return toBoolean(value);}catch(e){handleError(e);}return value;}}function transformObject(values,schema,parentUri,uri){if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);return getArrayFor(values,array,uri);}else{if((0,_common.hasAnyOf)(schema)){var _array5=(0,_common.getAnyOf)(schema);return getArrayFor(values,_array5,uri);}else{if((0,_common.hasOneOf)(schema)){var _array6=(0,_common.getOneOf)(schema);return getArrayFor(values,_array6,uri);}}}return transformObjectFor(values,schema,parentUri,uri);}function transformArray(values,schema,parentUri,uri){if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);return getArrayFor(values,array,uri);}else{if((0,_common.hasAnyOf)(schema)){var _array7=(0,_common.getAnyOf)(schema);return getArrayFor(values,_array7,uri);}else{if((0,_common.hasOneOf)(schema)){var _array8=(0,_common.getOneOf)(schema);return getArrayFor(values,_array8,uri);}}}return transformArrayFor(values,schema,parentUri,uri);}function transformNumber(values,schema,parentUri,uri){if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,array);});return transformValueFor(value,array);}else{if((0,_common.hasAnyOf)(schema)){var _array9=(0,_common.getAnyOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array9);});return transformValueFor(value,_array9);}else{if((0,_common.hasOneOf)(schema)){var _array10=(0,_common.getOneOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array10);});return transformValueFor(value,_array10);}}}try{if((0,_common.isArray)(value))return value.map(toNumber);return toNumber(value);}catch(e){handleError(e);}return value;}}function transformString(values,schema,parentUri,uri){if(Reflect.has(values,uri)){var value=Reflect.get(values,uri);if((0,_common.hasEnum)(schema)){var array=(0,_common.getEnum)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,array);});return transformValueFor(value,array);}else{if((0,_common.hasAnyOf)(schema)){var _array11=(0,_common.getAnyOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array11);});return transformValueFor(value,_array11);}else{if((0,_common.hasOneOf)(schema)){var _array12=(0,_common.getOneOf)(schema);if((0,_common.isArray)(value))return value.map(function(v){return transformValueFor(v,_array12);});return transformValueFor(value,_array12);}}}try{if((0,_common.isArray)(value))return value.map(toString);return toString(value);}catch(e){handleError(e);}return value;}}function transform(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var rootSchema=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var parentUri=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'#';var uri=arguments.length>3&&arguments[3]!==undefined?arguments[3]:(0,_common.getUri)(parentUri);log('fromHashToDocument');var type=rootSchema.type;switch(type){case'null':return transformNull(values,rootSchema,parentUri,uri);case'boolean':return transformBoolean(values,rootSchema,parentUri,uri);case'object':return transformObject(values,rootSchema,parentUri,uri);case'array':return transformArray(values,rootSchema,parentUri,uri);case'number':return transformNumber(values,rootSchema,parentUri,uri);case'string':return transformString(values,rootSchema,parentUri,uri);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}