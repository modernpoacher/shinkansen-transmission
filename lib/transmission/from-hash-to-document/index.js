"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.toNull=toNull;exports.toBoolean=toBoolean;exports.toString=toString;exports.toNumber=toNumber;exports.transformObjectSchema=transformObjectSchema;exports.transformArraySchema=transformArraySchema;exports.transformNull=transformNull;exports.transformBoolean=transformBoolean;exports.transformObject=transformObject;exports.transformArray=transformArray;exports.transformString=transformString;exports.transformNumber=transformNumber;exports.default=transform;exports.transformArraySchemaNumber=exports.transformArraySchemaString=exports.transformArraySchemaArray=exports.transformArraySchemaObject=exports.transformArraySchemaBoolean=exports.transformArraySchemaNull=exports.transformObjectSchemaNumber=exports.transformObjectSchemaString=exports.transformObjectSchemaArray=exports.transformObjectSchemaObject=exports.transformObjectSchemaBoolean=exports.transformObjectSchemaNull=void 0;var _common=require("../common");function toNull(v){if(v===null||v==='null')return null;throw new Error('Invalid `null`');}function toBoolean(v){if(typeof v==='boolean')return v;if(v==='true')return true;if(v==='false')return false;throw new Error('Invalid `boolean`');}function toString(v){if(typeof v==='string')return v;if(typeof v==='number')return String(v);return JSON.stringify(v);}function toNumber(v){if(typeof v==='number')return v;if(v){const n=Number(v);if(!isNaN(n))return n;}throw new Error('Invalid `number`');}const transformObjectSchemaNull=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformNull(schema,values,parentUri,uri);exports.transformObjectSchemaNull=transformObjectSchemaNull;const transformObjectSchemaBoolean=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformBoolean(schema,values,parentUri,uri);exports.transformObjectSchemaBoolean=transformObjectSchemaBoolean;const transformObjectSchemaObject=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformObject(schema,values,uri,uri);exports.transformObjectSchemaObject=transformObjectSchemaObject;const transformObjectSchemaArray=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformArray(schema,values,uri,uri);exports.transformObjectSchemaArray=transformObjectSchemaArray;const transformObjectSchemaString=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformString(schema,values,parentUri,uri);exports.transformObjectSchemaString=transformObjectSchemaString;const transformObjectSchemaNumber=(schema,values,{uri:parentUri,key:fieldKey},uri=(0,_common.getUri)(parentUri,fieldKey))=>transformNumber(schema,values,parentUri,uri);exports.transformObjectSchemaNumber=transformObjectSchemaNumber;function transformObjectSchema(schema={},values={},params={}){const{type}=schema;switch(type){case'null':return transformObjectSchemaNull(schema,values,params);case'boolean':return transformObjectSchemaBoolean(schema,values,params);case'object':return transformObjectSchemaObject(schema,values,params);case'array':return transformObjectSchemaArray(schema,values,params);case'string':return transformObjectSchemaString(schema,values,params);case'number':return transformObjectSchemaNumber(schema,values,params);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}const transformArraySchemaNull=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformNull(schema,values,parentUri,uri);exports.transformArraySchemaNull=transformArraySchemaNull;const transformArraySchemaBoolean=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformBoolean(schema,values,parentUri,uri);exports.transformArraySchemaBoolean=transformArraySchemaBoolean;const transformArraySchemaObject=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformObject(schema,values,uri,uri);exports.transformArraySchemaObject=transformArraySchemaObject;const transformArraySchemaArray=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformArray(schema,values,uri,uri);exports.transformArraySchemaArray=transformArraySchemaArray;const transformArraySchemaString=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformString(schema,values,parentUri,uri);exports.transformArraySchemaString=transformArraySchemaString;const transformArraySchemaNumber=(schema,values,{uri:parentUri,index:arrayIndex},uri=(0,_common.getUri)(parentUri,arrayIndex))=>transformNumber(schema,values,parentUri,uri);exports.transformArraySchemaNumber=transformArraySchemaNumber;function transformArraySchema(schema={},values={},params={}){const{type}=schema;switch(type){case'null':return transformArraySchemaNull(schema,values,params);case'boolean':return transformArraySchemaBoolean(schema,values,params);case'object':return transformArraySchemaObject(schema,values,params);case'array':return transformArraySchemaArray(schema,values,params);case'string':return transformArraySchemaString(schema,values,params);case'number':return transformArraySchemaNumber(schema,values,params);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}function transformNull(schema,values,parentUri,uri){if(Reflect.has(values,uri)){if((0,_common.hasEnum)(schema)){const items=(0,_common.getEnum)(schema);const index=toNumber(Reflect.get(values,uri));const value=items[index];return toNull(value);}return toNull(Reflect.get(values,uri));}}function transformBoolean(schema,values,parentUri,uri){if(Reflect.has(values,uri)){if((0,_common.hasEnum)(schema)){const items=(0,_common.getEnum)(schema);const index=toNumber(Reflect.get(values,uri));const value=items[index];return toBoolean(value);}return toBoolean(Reflect.get(values,uri));}}function transformObject({properties={}},values,parentUri,uri){return Object.entries(properties).reduce((accumulator,[key,schema])=>({...accumulator,[key]:transformObjectSchema(schema,values,{uri:parentUri,key})}),{});}function transformArray({items=[]},values,parentUri,uri){return Object.keys(values).filter(key=>key.startsWith(uri)).reduce((accumulator,key)=>{const value=uri.endsWith('/')?key.slice(uri.length):key.slice(uri.length+1);const index=Number(value.includes('/')?value.slice(0,value.indexOf('/')):value);if(!isNaN(index)){const schema=Array.isArray(items)?items[index]:items;accumulator[index]=transformArraySchema(schema,values,{uri:parentUri,index});}return accumulator;},[]);}function transformString(schema,values,parentUri,uri){if(Reflect.has(values,uri)){if((0,_common.hasEnum)(schema)){const items=(0,_common.getEnum)(schema);const index=toNumber(Reflect.get(values,uri));const value=items[index];return toString(value);}return toString(Reflect.get(values,uri));}}function transformNumber(schema,values,parentUri,uri){if(Reflect.has(values,uri)){if((0,_common.hasEnum)(schema)){const items=(0,_common.getEnum)(schema);const index=toNumber(Reflect.get(values,uri));const value=items[index];return toNumber(value);}return toNumber(Reflect.get(values,uri));}}function transform(rootSchema={},values={},parentUri='#',uri=(0,_common.getUri)(parentUri)){const{type}=rootSchema;switch(type){case'null':return transformNull(rootSchema,values,parentUri,uri);case'boolean':return transformBoolean(rootSchema,values,parentUri,uri);case'object':return transformObject(rootSchema,values,parentUri,uri);case'array':return transformArray(rootSchema,values,parentUri,uri);case'number':return transformNumber(rootSchema,values,parentUri,uri);case'string':return transformString(rootSchema,values,parentUri,uri);default:throw new Error('Schema does not conform to Instance Data Model, https://json-schema.org/draft/2019-09/json-schema-core.html#rfc.section.4.2.1');}}