"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSelectedItemsForParentUri=getSelectedItemsForParentUri;exports.getSelectedItemsForUri=getSelectedItemsForUri;exports.getMetaProps=getMetaProps;exports.getMetaDefaultValue=getMetaDefaultValue;exports.hasMetaValue=hasMetaValue;exports.getMetaValue=getMetaValue;exports.hasValue=hasValue;exports.getValue=getValue;exports.getValueForEnum=getValueForEnum;exports.getIndexForEnum=getIndexForEnum;exports.getValueForAnyOf=getValueForAnyOf;exports.getIndexForAnyOf=getIndexForAnyOf;exports.getValueForOneOf=getValueForOneOf;exports.getIndexForOneOf=getIndexForOneOf;exports.getElementsTitleProps=getElementsTitleProps;exports.getElementsDescriptionProps=getElementsDescriptionProps;exports.getElementsFieldPropsForEnum=getElementsFieldPropsForEnum;exports.getElementsFieldPropsForOneOf=getElementsFieldPropsForOneOf;exports.getElementsFieldPropsForAnyOf=getElementsFieldPropsForAnyOf;exports.getElementsFieldPropsForAllOf=getElementsFieldPropsForAllOf;exports.getElementsFieldProps=getElementsFieldProps;exports.getElementsFieldValue=getElementsFieldValue;exports.getMin=getMin;exports.getMax=getMax;exports.getMinLength=getMinLength;exports.getMaxLength=getMaxLength;exports.getMinItems=getMinItems;exports.getMaxItems=getMaxItems;exports.getHasUniqueItems=getHasUniqueItems;exports.getMinContains=getMinContains;exports.getMaxContains=getMaxContains;exports.getMinProperties=getMinProperties;exports.getMaxProperties=getMaxProperties;exports.getIsExclusiveMin=getIsExclusiveMin;exports.getIsExclusiveMax=getIsExclusiveMax;exports.getStep=getStep;exports.getPattern=exports.getUri=exports.getParentUri=exports.getAllOf=exports.hasAllOf=exports.getOneOf=exports.hasOneOf=exports.getAnyOf=exports.hasAnyOf=exports.getDefault=exports.hasDefault=exports.getConst=exports.hasConst=exports.getEnum=exports.hasEnum=exports.transformValue=exports.getParamsSelectedItems=exports.getParamsItems=exports.getIsRequired=exports.getIsWriteOnly=exports.getIsReadOnly=exports.getDescription=exports.getTitle=exports.normaliseUri=exports.isDefaultValue=exports.toDefaultValue=exports.isConstValue=exports.toConstValue=exports.isPrimitive=exports.isNullSchema=exports.isBooleanSchema=exports.isObjectSchema=exports.isArraySchema=exports.isNumberSchema=exports.isStringSchema=exports.isSchema=exports.isArray=exports.isObject=void 0;var _debug=_interopRequireDefault(require("debug"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}const log=(0,_debug.default)('shinkansen-transmission:common');const isObject=v=>(v||false)instanceof Object&&!isArray(v);exports.isObject=isObject;const isArray=v=>Array.isArray(v);exports.isArray=isArray;const isSchema=(v={})=>Reflect.has(v,'type');exports.isSchema=isSchema;const isStringSchema=({type}={})=>type==='string';exports.isStringSchema=isStringSchema;const isNumberSchema=({type}={})=>type==='number';exports.isNumberSchema=isNumberSchema;const isArraySchema=({type}={})=>type==='array';exports.isArraySchema=isArraySchema;const isObjectSchema=({type}={})=>type==='object';exports.isObjectSchema=isObjectSchema;const isBooleanSchema=({type}={})=>type==='boolean';exports.isBooleanSchema=isBooleanSchema;const isNullSchema=({type}={})=>type==='null';exports.isNullSchema=isNullSchema;const isPrimitive=v=>!isObject(v);exports.isPrimitive=isPrimitive;const toConstValue=(schema={})=>Reflect.get(schema,'const');exports.toConstValue=toConstValue;const isConstValue=(schema={})=>Reflect.has(schema,'const');exports.isConstValue=isConstValue;const toDefaultValue=(schema={})=>Reflect.get(schema,'default');exports.toDefaultValue=toDefaultValue;const isDefaultValue=(schema={})=>Reflect.has(schema,'default');exports.isDefaultValue=isDefaultValue;const normaliseUri=uri=>uri.endsWith('/')?uri:uri.concat('/');exports.normaliseUri=normaliseUri;const getTitle=({title}={})=>title?{title}:{};exports.getTitle=getTitle;const getDescription=({description}={})=>description?{description}:{};exports.getDescription=getDescription;const getIsReadOnly=({readOnly=false}={})=>readOnly?{readOnly}:{};exports.getIsReadOnly=getIsReadOnly;const getIsWriteOnly=({writeOnly=false}={})=>writeOnly?{writeOnly}:{};exports.getIsWriteOnly=getIsWriteOnly;const getIsRequired=(params={})=>Reflect.has(params,'required')?{required:Reflect.get(params,'required')}:{};exports.getIsRequired=getIsRequired;const getParamsItems=(params={},uri='#')=>{let items;if(Reflect.has(params,uri)){({meta:{items}={}}=Reflect.get(params,uri));}return items||{};};exports.getParamsItems=getParamsItems;const getParamsSelectedItems=(params={},uri='#')=>{let selectedItems;if(Reflect.has(params,uri)){({meta:{selectedItems}={}}=Reflect.get(params,uri));}return selectedItems||{};};exports.getParamsSelectedItems=getParamsSelectedItems;function getSelectedItemsForParentUri(values={},parentUri='#',uri='#'){log('getSelectedItemsForParentUri',parentUri,uri);if(Reflect.has(values,parentUri)){const value=Reflect.get(values,parentUri);log('getSelectedItemsForParentUri (1)');if(isArray(value)){log('getSelectedItemsForParentUri (1 - 1)');return value.reduce((accumulator,v)=>{if(isPrimitive(v)){const n=Number(v);if(!isNaN(n))return accumulator.concat(n);}return accumulator;},[]);}if(isPrimitive(value)){log('getSelectedItemsForParentUri (1 - 2)');const n=Number(value);if(!isNaN(n))return[n];}}log('getSelectedItemsForParentUri (2)');const pattern=new RegExp(`^${normaliseUri(parentUri)}\\d+$`);return Object.entries(values).filter(([key])=>pattern.test(key)).reduce((accumulator,[key,value])=>{const k=parentUri.endsWith('/')?key.slice(parentUri.length):key.slice(parentUri.length+1);const i=k?Number(k.includes('/')?k.slice(0,k.indexOf('/')):k):NaN;if(!isNaN(i)){const v=isArray(value)?value[i]:value;if(isPrimitive(v)){const n=Number(v);if(!isNaN(n))return accumulator.concat(n);}}return accumulator;},[]);}function getSelectedItemsForUri(values={},parentUri='#',uri='#'){log('getSelectedItemsForUri',uri);if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);if(isArray(value)){log('getSelectedItemsForUri (1 - 1)');return value.reduce((accumulator,v)=>{if(isPrimitive(v)){const n=Number(v);if(!isNaN(n))return accumulator.concat(n);}return accumulator;},[]);}log('getSelectedItemsForUri (1 - 2)');if(isPrimitive(value)){const n=Number(value);if(!isNaN(n))return[n];}}log('getSelectedItemsForUri (2)');const pattern=new RegExp(`^${normaliseUri(uri)}\\d+$`);return Object.entries(values).filter(([key])=>pattern.test(key)).reduce((accumulator,[key,value])=>{const k=uri.endsWith('/')?key.slice(uri.length):key.slice(uri.length+1);const i=k?Number(k.includes('/')?k.slice(0,k.indexOf('/')):k):NaN;log({key,value,k,i});if(!isNaN(i)){const v=isArray(value)?value[i]:value;if(isPrimitive(v)){const n=Number(v);if(!isNaN(n))return accumulator.concat(n);}}return accumulator;},[]);}function getMetaProps(params={},uri='#'){log('getMetaProps');let meta;if(Reflect.has(params,uri)){({meta}=Reflect.get(params,uri));}return meta||{};}function getMetaDefaultValue(schema={}){if(Reflect.has(schema,'default')){const defaultValue=Reflect.get(schema,'default');return{defaultValue:String(defaultValue)};}return{};}function hasMetaValue(values={},uri='#',schema={}){log('hasMetaValue');if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);if(isArraySchema(schema)){log(`

is Array schema

      `);throw new Error('Uri Array schema');}else{if(isObjectSchema(schema)){log(`

is Object schema

        `);throw new Error('Uri Object schema');}else{if(isArray(value))throw new Error('Is Array');return isPrimitive(value);}}}else{if(Reflect.has(schema,'const')){const constValue=Reflect.get(schema,'const');return isPrimitive(constValue);}}return false;}function getMetaValue(values={},uri='#',schema={}){log('getMetaValue');if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);if(isArraySchema(schema)){log(`

  is Array schema

      `);throw new Error('Uri Array schema');}else{if(isObjectSchema(schema)){log(`

  is Object schema

        `);throw new Error('Uri Object schema');}else{if(isArray(value))throw new Error('Is Array');if(isPrimitive(value)){return{value:String(value)};}}}}else{if(Reflect.has(schema,'const')){const constValue=Reflect.get(schema,'const');if(isPrimitive(constValue)){return{value:String(constValue)};}}}return{};}function hasValue(values={},uri='#',schema={}){log('hasValue');if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);if(isArraySchema(schema)){log(`

  is Array schema

      `);throw new Error('Uri Array schema');}else{if(isObjectSchema(schema)){log(`

  is Object schema

        `);throw new Error('Uri Object schema');}else{if(isArray(value))throw new Error('Is Array');return isPrimitive(value);}}}else{if(Reflect.has(schema,'const')){const constValue=Reflect.get(schema,'const');return isPrimitive(constValue);}}return false;}function getValue(values={},uri='#',schema={}){log('getValue');if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);if(isArraySchema(schema)){log(`

  is Array schema

      `);throw new Error('Uri Array schema');}else{if(isObjectSchema(schema)){log(`

  is Object schema

        `);throw new Error('Uri Object schema');}else{if(isArray(value))throw new Error('Is Array');if(isPrimitive(value)){return String(value);}}}}else{if(Reflect.has(schema,'const')){const constValue=Reflect.get(schema,'const');if(isPrimitive(constValue)){return String(constValue);}}}}const transformValue=schema=>isObject(schema)?isConstValue(schema)?toConstValue(schema):isDefaultValue(schema)?toDefaultValue(schema):schema:schema;exports.transformValue=transformValue;function getValueForEnum(v,{enum:items=[]}={}){log('getValueForEnum');if(Reflect.has(items,v)){const enumValue=Reflect.get(items,v);return String(enumValue);}}function getIndexForEnum(values={},parentUri='#',uri='#',schema={}){log('getIndexForEnum');if(/\/\d+$/.test(uri)){return Number(uri.slice(uri.lastIndexOf('/')+1));}return NaN;}function getValueForAnyOf(v,{anyOf:items=[]}={}){log('getValueForAnyOf');if(Reflect.has(items,v)){const anyOf=Reflect.get(items,v);const anyOfValue=transformValue(anyOf);if(isPrimitive(anyOfValue)){return String(anyOfValue);}}}function getIndexForAnyOf(values={},parentUri='#',uri='#',schema={}){log('getIndexForAnyOf');if(/\/\d+$/.test(uri)){return Number(uri.slice(uri.lastIndexOf('/')+1));}return NaN;}function getValueForOneOf(v,{oneOf:items=[]}={}){log('getValueForOneOf');if(Reflect.has(items,v)){const oneOf=Reflect.get(items,v);const oneOfValue=transformValue(oneOf);if(isPrimitive(oneOfValue)){return String(oneOfValue);}}}function getIndexForOneOf(values={},parentUri='#',uri='#',schema={}){log('getIndexForOneOf');if(/\/\d+$/.test(uri)){return Number(uri.slice(uri.lastIndexOf('/')+1));}return NaN;}function getElementsTitleProps(params={},uri='#'){let title;if(Reflect.has(params,uri)){({elements:{title}={}}=Reflect.get(params,uri));}return title||{};}function getElementsDescriptionProps(params={},uri='#'){let description;if(Reflect.has(params,uri)){({elements:{description}={}}=Reflect.get(params,uri));}return description||{};}function getElementsFieldPropsForEnum(params={},uri='#'){let field;if(Reflect.has(params,uri)){({elements:{enum:field}={}}=Reflect.get(params,uri));}return field||{};}function getElementsFieldPropsForOneOf(params={},uri='#'){let field;if(Reflect.has(params,uri)){({elements:{oneOf:field}={}}=Reflect.get(params,uri));}return field||{};}function getElementsFieldPropsForAnyOf(params={},uri='#'){let field;if(Reflect.has(params,uri)){({elements:{anyOf:field}={}}=Reflect.get(params,uri));}return field||{};}function getElementsFieldPropsForAllOf(params={},uri='#'){let field;if(Reflect.has(params,uri)){({elements:{field}={}}=Reflect.get(params,uri));}return field||{};}function getElementsFieldProps(params={},uri='#'){let field;if(Reflect.has(params,uri)){({elements:{field}={}}=Reflect.get(params,uri));}return field||{};}function getElementsFieldValue(values={},uri='#',schema={}){if(Reflect.has(values,uri)){const value=Reflect.get(values,uri);return{value:String(value)};}else{if(Reflect.has(schema,'const')){const constValue=Reflect.get(schema,'const');if(isPrimitive(constValue)){return{value:String(constValue)};}}else{if(Reflect.has(schema,'default')){const defaultValue=Reflect.get(schema,'default');if(isPrimitive(defaultValue)){return{value:String(defaultValue)};}}}}return{};}const hasEnum=(schema={})=>Reflect.has(schema,'enum');exports.hasEnum=hasEnum;const getEnum=(schema={})=>Reflect.get(schema,'enum');exports.getEnum=getEnum;const hasConst=(schema={})=>Reflect.has(schema,'const');exports.hasConst=hasConst;const getConst=(schema={})=>Reflect.get(schema,'const');exports.getConst=getConst;const hasDefault=(schema={})=>Reflect.has(schema,'default');exports.hasDefault=hasDefault;const getDefault=(schema={})=>Reflect.get(schema,'default');exports.getDefault=getDefault;const hasAnyOf=(schema={})=>Reflect.has(schema,'anyOf');exports.hasAnyOf=hasAnyOf;const getAnyOf=(schema={})=>Reflect.get(schema,'anyOf');exports.getAnyOf=getAnyOf;const hasOneOf=(schema={})=>Reflect.has(schema,'oneOf');exports.hasOneOf=hasOneOf;const getOneOf=(schema={})=>Reflect.get(schema,'oneOf');exports.getOneOf=getOneOf;const hasAllOf=(schema={})=>Reflect.has(schema,'allOf');exports.hasAllOf=hasAllOf;const getAllOf=(schema={})=>Reflect.get(schema,'allOf');exports.getAllOf=getAllOf;const getParentUri=(parentUri='#')=>parentUri==='#'?'#/':parentUri;exports.getParentUri=getParentUri;const getUri=(uri='#',resource='')=>(uri.endsWith('/')?uri:uri.concat('/')).concat(resource);exports.getUri=getUri;function getMin({minimum}={}){const value=Number(minimum);return isNaN(value)?{}:{min:value};}function getMax({maximum}={}){const value=Number(maximum);return isNaN(value)?{}:{max:value};}function getMinLength({minLength}={}){const value=Number(minLength);return isNaN(value)?{}:{minLength:value};}function getMaxLength({maxLength}={}){const value=Number(maxLength);return isNaN(value)?{}:{maxLength:value};}function getMinItems({minItems}={}){const value=Number(minItems);return isNaN(value)?{}:{minItems:value};}function getMaxItems({maxItems}={}){const value=Number(maxItems);return isNaN(value)?{}:{maxItems:value};}function getHasUniqueItems(schema={}){if(Reflect.has(schema,'uniqueItems')){const value=Reflect.get(schema,'uniqueItems');return typeof value==='boolean'?{hasUniqueItems:value}:{};}return{};}function getMinContains({minContains}={}){const value=Number(minContains);return isNaN(value)?{}:{minContains:value};}function getMaxContains({maxContains}={}){const value=Number(maxContains);return isNaN(value)?{}:{maxContains:value};}function getMinProperties({minProperties}={}){const value=Number(minProperties);return isNaN(value)?{}:{minProperties:value};}function getMaxProperties({maxProperties}={}){const value=Number(maxProperties);return isNaN(value)?{}:{maxProperties:value};}function getIsExclusiveMin(schema={}){if(Reflect.has(schema,'exclusiveMinimum')){const value=Reflect.get(schema,'exclusiveMinimum');return typeof value==='boolean'?{isExclusiveMin:value}:{};}return{};}function getIsExclusiveMax(schema={}){if(Reflect.has(schema,'exclusiveMaximum')){const value=Reflect.get(schema,'exclusiveMaximum');return typeof value==='boolean'?{isExclusiveMax:value}:{};}return{};}const getPattern=({pattern}={})=>pattern?{pattern}:{};exports.getPattern=getPattern;function getStep({multipleOf}={}){const value=Number(multipleOf);return isNaN(value)?{}:{step:value};}